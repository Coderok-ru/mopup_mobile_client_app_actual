#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è .xcconfig —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è

echo "üîß –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é .xcconfig —Ñ–∞–π–ª—ã..."

IOS_DIR="ios/Pods/Target Support Files"

find "$IOS_DIR" -name "*.xcconfig" -type f | while read -r file; do
  # –ß–∏—Ç–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
  content=$(cat "$file")
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (–ø–æ–≤—Ä–µ–∂–¥–µ–Ω)
  line_count=$(echo "$content" | wc -l)
  
  if [ "$line_count" -le 2 ]; then
    echo "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é: $file"
    
    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π (—Å—Ç—Ä–æ–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã –∏–ª–∏ –ø—Ä–æ–±–µ–ª–∞ –ø–æ—Å–ª–µ =)
    restored=$(echo "$content" | sed -E 's/([A-Z][A-Za-z0-9_]* = |^CLANG_|^CONFIGURATION_|^DEFINES_|^FRAMEWORK_|^GCC_|^HEADER_|^LD_|^LIBRARY_|^OTHER_|^PODS_|^PRODUCT_|^SKIP_|^USE_)/\n\1/g' | sed '/^$/d')
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    echo "$restored" > "$file"
  fi
done

echo "‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
